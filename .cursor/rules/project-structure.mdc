---
alwaysApply: true
---

# Project structure (monorepo)

## Shared code → `packages/store` (@repo/store)

Put in **store** anything used by both API and web (or likely reused later):

- **Types**: `packages/store/src/types/` — domain types (User, Doctor, Drug, Patient, etc.). One file per domain, e.g. `drug.ts`, `user/user.type.ts`. Export via `types/index.ts`.
- **Enums**: `packages/store/src/enums/` — domain enums (UserRole, DrugForm, QueueStatus, etc.). One file per domain, e.g. `drug.enum.ts`. Export via `enums/index.ts`.
- **DTOs**: `packages/store/src/dtos/` — request/input shapes (CreateUserInput, CreateSpecializationDto, etc.). Group by domain under subfolders. Export via `dtos/index.ts`.
- **Utils**: `packages/store/src/utils/` — pure helpers used across apps (formatLabel, formatAge, formatGender, etc.). Export via `utils/index.ts`.

API and web must **import** these from `@repo/store`; do not duplicate types/enums/utils in apps.

---

## API → `apps/api/src`

- **Feature code**: `src/modules/<domain>/` — e.g. `modules/common/doctors/`, `modules/auth/users/`, `modules/client/appointments/`.
  - **Controller**: `*.controller.ts`
  - **Service**: `*.service.ts`
  - **Module**: `*.module.ts`
  - **Entities** (TypeORM): `entities/*.entity.ts` — DB-only shape; use suffix `Entity` (e.g. `Drug` entity → `Drug` class in `drug.entity.ts`). Import types/enums from `@repo/store`.
  - **API-only types**: optional `*.types.ts` or `*.helper.ts` in the same module when not shared.
- **Cross-cutting**: `src/common/` — db, middleware, pipes, request-context, utils.
- **App types**: `src/types/` — only for API-specific declarations (e.g. `express.d.ts`).

Prefer DTOs and validation from `@repo/store`; use `ZodValidationPipe` with store schemas where applicable.

---

## Web → `apps/web`

- **Pages**: `app/` — Next.js App Router (e.g. `app/dashboard/drugs/`, `app/auth/login/`).
- **UI**: `components/` — `components/dashboard/<feature>/`, `components/ui/`, `components/auth/`, etc.
- **API client**: `services/client/<domain>/` — e.g. `doctor/`, `drug/`, `patient/`. Use `*.api.ts` for HTTP calls; import types/enums from `@repo/store`.
- **Shared web**: `libs/`, `hooks/`, `utils/`, `store/` (e.g. Zustand), `types/` — app-specific only. Do not redefine types/enums that exist in `@repo/store`.

---

## Type safety

- **Never use `as` type assertions.** Use type guards, Zod parse/safeParse, or fix types. See `.cursor/rules/typescript.mdc`.
